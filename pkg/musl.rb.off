name      :musl
version   '1.1.22'
archive   "https://www.musl-libc.org/releases/musl-#{version}.tar.gz"
signature "#{archive}.asc"
checksum   '8b0941a48d2f980fd7036cfbd24aa1d414f03d9a0652ecbd5ec5c7ff1bee29e3'

on_build do |package|
  cd package.build_path do
    sh <<~EOS
      ./configure \
        --prefix=/usr/lib/musl \
        --exec-prefix=/usr \
        --enable-wrapper=all
    EOS

    make
  end
end

on_install do |package|
  cd(package.build_path) { make :install, 'DESTDIR' => paths.project_root.join(paths.os_root) }

  cd paths.os_root do
    sh "mv lib/ld-musl*.so* usr/lib/"
    ln_sf "usr/lib/musl/lib/libc.so", "usr/lib/libc.so"
    ln_sf "usr/lib/libc.so", "usr/lib/libc.so.6"
  end
end

files %W(
  /usr/bin/ld.musl-clang
  /usr/bin/musl-clang
  /usr/bin/musl-gcc
  /usr/lib/libc.so
  /usr/lib/libc.so.6
  /usr/lib/musl/include/aio.h
  /usr/lib/musl/include/alloca.h
  /usr/lib/musl/include/ar.h
  /usr/lib/musl/include/arpa/ftp.h
  /usr/lib/musl/include/arpa/inet.h
  /usr/lib/musl/include/arpa/nameser.h
  /usr/lib/musl/include/arpa/nameser_compat.h
  /usr/lib/musl/include/arpa/telnet.h
  /usr/lib/musl/include/arpa/tftp.h
  /usr/lib/musl/include/assert.h
  /usr/lib/musl/include/bits/alltypes.h
  /usr/lib/musl/include/bits/endian.h
  /usr/lib/musl/include/bits/errno.h
  /usr/lib/musl/include/bits/fcntl.h
  /usr/lib/musl/include/bits/fenv.h
  /usr/lib/musl/include/bits/float.h
  /usr/lib/musl/include/bits/hwcap.h
  /usr/lib/musl/include/bits/io.h
  /usr/lib/musl/include/bits/ioctl.h
  /usr/lib/musl/include/bits/ioctl_fix.h
  /usr/lib/musl/include/bits/ipc.h
  /usr/lib/musl/include/bits/kd.h
  /usr/lib/musl/include/bits/limits.h
  /usr/lib/musl/include/bits/link.h
  /usr/lib/musl/include/bits/mman.h
  /usr/lib/musl/include/bits/msg.h
  /usr/lib/musl/include/bits/poll.h
  /usr/lib/musl/include/bits/posix.h
  /usr/lib/musl/include/bits/ptrace.h
  /usr/lib/musl/include/bits/reg.h
  /usr/lib/musl/include/bits/resource.h
  /usr/lib/musl/include/bits/sem.h
  /usr/lib/musl/include/bits/setjmp.h
  /usr/lib/musl/include/bits/shm.h
  /usr/lib/musl/include/bits/signal.h
  /usr/lib/musl/include/bits/socket.h
  /usr/lib/musl/include/bits/soundcard.h
  /usr/lib/musl/include/bits/stat.h
  /usr/lib/musl/include/bits/statfs.h
  /usr/lib/musl/include/bits/stdint.h
  /usr/lib/musl/include/bits/syscall.h
  /usr/lib/musl/include/bits/termios.h
  /usr/lib/musl/include/bits/user.h
  /usr/lib/musl/include/bits/vt.h
  /usr/lib/musl/include/byteswap.h
  /usr/lib/musl/include/complex.h
  /usr/lib/musl/include/cpio.h
  /usr/lib/musl/include/crypt.h
  /usr/lib/musl/include/ctype.h
  /usr/lib/musl/include/dirent.h
  /usr/lib/musl/include/dlfcn.h
  /usr/lib/musl/include/elf.h
  /usr/lib/musl/include/endian.h
  /usr/lib/musl/include/err.h
  /usr/lib/musl/include/errno.h
  /usr/lib/musl/include/fcntl.h
  /usr/lib/musl/include/features.h
  /usr/lib/musl/include/fenv.h
  /usr/lib/musl/include/float.h
  /usr/lib/musl/include/fmtmsg.h
  /usr/lib/musl/include/fnmatch.h
  /usr/lib/musl/include/ftw.h
  /usr/lib/musl/include/getopt.h
  /usr/lib/musl/include/glob.h
  /usr/lib/musl/include/grp.h
  /usr/lib/musl/include/iconv.h
  /usr/lib/musl/include/ifaddrs.h
  /usr/lib/musl/include/inttypes.h
  /usr/lib/musl/include/iso646.h
  /usr/lib/musl/include/langinfo.h
  /usr/lib/musl/include/lastlog.h
  /usr/lib/musl/include/libgen.h
  /usr/lib/musl/include/libintl.h
  /usr/lib/musl/include/limits.h
  /usr/lib/musl/include/link.h
  /usr/lib/musl/include/locale.h
  /usr/lib/musl/include/malloc.h
  /usr/lib/musl/include/math.h
  /usr/lib/musl/include/memory.h
  /usr/lib/musl/include/mntent.h
  /usr/lib/musl/include/monetary.h
  /usr/lib/musl/include/mqueue.h
  /usr/lib/musl/include/net/ethernet.h
  /usr/lib/musl/include/net/if.h
  /usr/lib/musl/include/net/if_arp.h
  /usr/lib/musl/include/net/route.h
  /usr/lib/musl/include/netdb.h
  /usr/lib/musl/include/netinet/ether.h
  /usr/lib/musl/include/netinet/icmp6.h
  /usr/lib/musl/include/netinet/if_ether.h
  /usr/lib/musl/include/netinet/igmp.h
  /usr/lib/musl/include/netinet/in.h
  /usr/lib/musl/include/netinet/in_systm.h
  /usr/lib/musl/include/netinet/ip.h
  /usr/lib/musl/include/netinet/ip6.h
  /usr/lib/musl/include/netinet/ip_icmp.h
  /usr/lib/musl/include/netinet/tcp.h
  /usr/lib/musl/include/netinet/udp.h
  /usr/lib/musl/include/netpacket/packet.h
  /usr/lib/musl/include/nl_types.h
  /usr/lib/musl/include/paths.h
  /usr/lib/musl/include/poll.h
  /usr/lib/musl/include/pthread.h
  /usr/lib/musl/include/pty.h
  /usr/lib/musl/include/pwd.h
  /usr/lib/musl/include/regex.h
  /usr/lib/musl/include/resolv.h
  /usr/lib/musl/include/sched.h
  /usr/lib/musl/include/scsi/scsi.h
  /usr/lib/musl/include/scsi/scsi_ioctl.h
  /usr/lib/musl/include/scsi/sg.h
  /usr/lib/musl/include/search.h
  /usr/lib/musl/include/semaphore.h
  /usr/lib/musl/include/setjmp.h
  /usr/lib/musl/include/shadow.h
  /usr/lib/musl/include/signal.h
  /usr/lib/musl/include/spawn.h
  /usr/lib/musl/include/stdalign.h
  /usr/lib/musl/include/stdarg.h
  /usr/lib/musl/include/stdbool.h
  /usr/lib/musl/include/stdc-predef.h
  /usr/lib/musl/include/stddef.h
  /usr/lib/musl/include/stdint.h
  /usr/lib/musl/include/stdio.h
  /usr/lib/musl/include/stdio_ext.h
  /usr/lib/musl/include/stdlib.h
  /usr/lib/musl/include/stdnoreturn.h
  /usr/lib/musl/include/string.h
  /usr/lib/musl/include/strings.h
  /usr/lib/musl/include/stropts.h
  /usr/lib/musl/include/sys/acct.h
  /usr/lib/musl/include/sys/auxv.h
  /usr/lib/musl/include/sys/cachectl.h
  /usr/lib/musl/include/sys/dir.h
  /usr/lib/musl/include/sys/epoll.h
  /usr/lib/musl/include/sys/errno.h
  /usr/lib/musl/include/sys/eventfd.h
  /usr/lib/musl/include/sys/fanotify.h
  /usr/lib/musl/include/sys/fcntl.h
  /usr/lib/musl/include/sys/file.h
  /usr/lib/musl/include/sys/fsuid.h
  /usr/lib/musl/include/sys/inotify.h
  /usr/lib/musl/include/sys/io.h
  /usr/lib/musl/include/sys/ioctl.h
  /usr/lib/musl/include/sys/ipc.h
  /usr/lib/musl/include/sys/kd.h
  /usr/lib/musl/include/sys/klog.h
  /usr/lib/musl/include/sys/membarrier.h
  /usr/lib/musl/include/sys/mman.h
  /usr/lib/musl/include/sys/mount.h
  /usr/lib/musl/include/sys/msg.h
  /usr/lib/musl/include/sys/mtio.h
  /usr/lib/musl/include/sys/param.h
  /usr/lib/musl/include/sys/personality.h
  /usr/lib/musl/include/sys/poll.h
  /usr/lib/musl/include/sys/prctl.h
  /usr/lib/musl/include/sys/procfs.h
  /usr/lib/musl/include/sys/ptrace.h
  /usr/lib/musl/include/sys/quota.h
  /usr/lib/musl/include/sys/random.h
  /usr/lib/musl/include/sys/reboot.h
  /usr/lib/musl/include/sys/reg.h
  /usr/lib/musl/include/sys/resource.h
  /usr/lib/musl/include/sys/select.h
  /usr/lib/musl/include/sys/sem.h
  /usr/lib/musl/include/sys/sendfile.h
  /usr/lib/musl/include/sys/shm.h
  /usr/lib/musl/include/sys/signal.h
  /usr/lib/musl/include/sys/signalfd.h
  /usr/lib/musl/include/sys/socket.h
  /usr/lib/musl/include/sys/soundcard.h
  /usr/lib/musl/include/sys/stat.h
  /usr/lib/musl/include/sys/statfs.h
  /usr/lib/musl/include/sys/statvfs.h
  /usr/lib/musl/include/sys/stropts.h
  /usr/lib/musl/include/sys/swap.h
  /usr/lib/musl/include/sys/syscall.h
  /usr/lib/musl/include/sys/sysinfo.h
  /usr/lib/musl/include/sys/syslog.h
  /usr/lib/musl/include/sys/sysmacros.h
  /usr/lib/musl/include/sys/termios.h
  /usr/lib/musl/include/sys/time.h
  /usr/lib/musl/include/sys/timeb.h
  /usr/lib/musl/include/sys/timerfd.h
  /usr/lib/musl/include/sys/times.h
  /usr/lib/musl/include/sys/timex.h
  /usr/lib/musl/include/sys/ttydefaults.h
  /usr/lib/musl/include/sys/types.h
  /usr/lib/musl/include/sys/ucontext.h
  /usr/lib/musl/include/sys/uio.h
  /usr/lib/musl/include/sys/un.h
  /usr/lib/musl/include/sys/user.h
  /usr/lib/musl/include/sys/utsname.h
  /usr/lib/musl/include/sys/vfs.h
  /usr/lib/musl/include/sys/vt.h
  /usr/lib/musl/include/sys/wait.h
  /usr/lib/musl/include/sys/xattr.h
  /usr/lib/musl/include/syscall.h
  /usr/lib/musl/include/sysexits.h
  /usr/lib/musl/include/syslog.h
  /usr/lib/musl/include/tar.h
  /usr/lib/musl/include/termios.h
  /usr/lib/musl/include/tgmath.h
  /usr/lib/musl/include/threads.h
  /usr/lib/musl/include/time.h
  /usr/lib/musl/include/uchar.h
  /usr/lib/musl/include/ucontext.h
  /usr/lib/musl/include/ulimit.h
  /usr/lib/musl/include/unistd.h
  /usr/lib/musl/include/utime.h
  /usr/lib/musl/include/utmp.h
  /usr/lib/musl/include/utmpx.h
  /usr/lib/musl/include/values.h
  /usr/lib/musl/include/wait.h
  /usr/lib/musl/include/wchar.h
  /usr/lib/musl/include/wctype.h
  /usr/lib/musl/include/wordexp.h
  /usr/lib/musl/lib/Scrt1.o
  /usr/lib/musl/lib/crt1.o
  /usr/lib/musl/lib/crti.o
  /usr/lib/musl/lib/crtn.o
  /usr/lib/musl/lib/libc.a
  /usr/lib/musl/lib/libc.so
  /usr/lib/musl/lib/libcrypt.a
  /usr/lib/musl/lib/libdl.a
  /usr/lib/musl/lib/libm.a
  /usr/lib/musl/lib/libpthread.a
  /usr/lib/musl/lib/libresolv.a
  /usr/lib/musl/lib/librt.a
  /usr/lib/musl/lib/libutil.a
  /usr/lib/musl/lib/libxnet.a
  /usr/lib/musl/lib/musl-gcc.specs
  /usr/lib/musl/lib/rcrt1.o
)

